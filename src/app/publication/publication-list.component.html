<div class="pubs-root">
  <h2>Publications</h2>
  <mat-progress-spinner *ngIf="loading" mode="indeterminate"></mat-progress-spinner>

  <mat-form-field appearance="outline" style="width:360px; margin-bottom:12px;">
    <mat-label>Search publications</mat-label>
    <input matInput (input)="applyFilter($event)" placeholder="title, type, date" />
  </mat-form-field>

  <mat-form-field appearance="outline" style="width:220px; margin-left:16px; margin-bottom:12px;" *ngIf="availableTypes.length">
    <mat-label>Type</mat-label>
    <mat-select (selectionChange)="onTypeFilterChange($event.value)">
      <mat-option value="">All</mat-option>
      <mat-option *ngFor="let t of availableTypes" [value]="t">{{ t }}</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline" style="width:180px; margin-left:16px; margin-bottom:12px;" *ngIf="availableYears.length">
    <mat-label>Year</mat-label>
    <mat-select (selectionChange)="onYearFilterChange($event.value)">
      <mat-option value="">All</mat-option>
      <mat-option *ngFor="let y of availableYears" [value]="y">{{ y }}</mat-option>
    </mat-select>
  </mat-form-field>

  <div class="pubs-grid">
    <mat-card *ngFor="let p of filtered" class="pub-card">
      <mat-card-header>
        <mat-card-title>{{ p.titre }}</mat-card-title>
        <mat-card-subtitle>{{ p.type }} â€” {{ p.date | date }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <p *ngIf="p.lien">Lien: <a href="{{p.lien}}" target="_blank">ouvrir</a></p>
      </mat-card-content>
      <mat-card-actions>
        <a mat-button color="primary" [routerLink]="['/publications', p.id]">View</a>
        <a mat-button color="accent" *ngIf="p.sourcepdf" [href]="p.sourcepdf" target="_blank">Download PDF</a>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
